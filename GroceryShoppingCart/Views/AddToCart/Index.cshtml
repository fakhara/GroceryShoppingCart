@model GroceryShoppingCart.ViewModel.ShoppingCartViewModel
@{
    ViewBag.Title = "Shopping Cart";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h3 class="text-left"><span><img src="~/Content/image/shoping_cart.png"/>Your shopping cart</span></h3>
<div id="update-message" class="text-info"></div>
<div id="dvContents">
    @if (Model.CartItems.Count == 0)
    {
        <a class="btn-danger" href="~/StoreFront/Index/1">Your shopping cart is empty, continue shopping---></a>
    }
    else
    {
        <table class="table-responsive table-bordered table-striped">
            <tr>
                <th>Product Name</th>
                <th>Image</th>
                <th>Price (each)</th>
                <th>Quantity</th>
                <th>Sub-Total</th>
                <th>Action</th>
            </tr>
            @foreach (var item in Model.CartItems)
            {
                <tr id="row-@item.ProductId">
                    <td>@item.Product.Name</td>
                    <td><img src="~/Images/Uploads/Products//@item.Product.Id/Thumbs/@item.Product.ImageName" height="100" width="75" /></td>
                    <td>@item.Product.Price</td>
                    <td id="item-count-@item.ProductId">@item.Count</td>
                    <td>@((item.Product.Price * item.Count).ToString())</td>
                    <td><a href="#" class="RemoveLink" data-id="@item.ProductId">Remove from cart</a></td>
                </tr>
            }
            <tr>
                <td>Total</td>
                <td></td>
                <td></td>
                <td id="cart-total" class="text-success">
                    <b>@Model.CartTotal.ToString()</b>
                </td>
            </tr>
        </table>
        <div>
            <a id="btnPrint" class="btn btn-info btn-lg"><span class="glyphicon glyphicon-print"></span>Print</a>
            <a id="btn_add" href="~/StoreFront/Index/1" class="btn btn-info btn-lg">
                <span class="glyphicon glyphicon-eye-open"></span> Continue shopping
            </a>
            <a id="btn_add" class="btn btn-info btn-lg" onclick="location.href='@Url.Action("AddressAndPayment", "Checkout")'">
                Check Out &raquo;
            </a>
        </div>
    }
    </div>
    <script src="/Scripts/jquery-1.4.4.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(function () {
            // Document.ready -> link up remove event handler
            $(".RemoveLink").click(function () {
                // Get the id from the link
                var recordToDelete = $(this).attr("data-id");
                if (recordToDelete != '') {
                    // Perform the ajax post
                    $.post("/AddToCart/RemoveFromCart", { "id": recordToDelete },
                        function (data) {
                            // Successful requests get here
                            // Update the page elements
                            if (data.ItemCount == 0) {
                                $('#row-' + data.DeleteId).fadeOut('slow');
                            } else {
                                $('#item-count-' + data.DeleteId).text(data.ItemCount);
                            }
                            $('#cart-total').text(data.CartTotal);
                            $('#update-message').text(data.Message);
                            $('#cart-status').text('Cart (' + data.CartCount + ')');
                        });
                }
            });
        });
    </script>
    <script type="text/javascript">
        $(function () {
            $("#btnPrint").click(function () {
                var contents = $("#dvContents").html();
                var frame1 = $('<iframe />');
                frame1[0].name = "frame1";
                frame1.css({ "position": "absolute", "top": "-1000000px" });
                $("body").append(frame1);
                var frameDoc = frame1[0].contentWindow ? frame1[0].contentWindow : frame1[0].contentDocument.document ? frame1[0].contentDocument.document : frame1[0].contentDocument;
                frameDoc.document.open();
                //Create a new HTML document.
                frameDoc.document.write('<html><head><title>DIV Contents</title>');
                frameDoc.document.write('</head><body>');
                //Append the external CSS file.
                frameDoc.document.write('<link href="style.css" rel="stylesheet" type="text/css" />');
                //Append the DIV contents.
                frameDoc.document.write(contents);
                frameDoc.document.write('</body></html>');
                frameDoc.document.close();
                setTimeout(function () {
                    window.frames["frame1"].focus();
                    window.frames["frame1"].print();
                    //frame1.remove();
                }, 500);
            });
        });
    </script>
